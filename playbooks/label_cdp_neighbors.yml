- name: Label CDP Neighbors
  hosts: all
  gather_facts: false

  tasks:
    - name: Gather nxos facts
      cisco.nxos.nxos_facts:
        gather_subset: all

    - name: Set NXOS Interface Description
      when: ansible_network_os == 'nxos'
      loop: "{{ ansible_facts.net_neighbors | dict2items }}"
      cisco.nxos.nxos_config:
        lines:
          - description Connected to {{ item.value[0].host }} via its {{ item.value[0].port }}
        parents: interface {{ item.key }}
        save_when: changed
